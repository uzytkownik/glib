## Makefile for building the gthread dll with Microsoft C
## Use: nmake -f makefile.msc install

GLIB_VER = @GLIB_MAJOR_VERSION@.@GLIB_MINOR_VERSION@

TOP = ..\..

!INCLUDE $(TOP)\build\win32\make.msc

# Possibly override GLib version in build\win32\module.defs
GLIB_VER = @GLIB_MAJOR_VERSION@.@GLIB_MINOR_VERSION@

################################################################

# Nothing much configurable below

INCLUDES = -I .. -I .
DEFINES = -DHAVE_CONFIG_H -DG_LOG_DOMAIN=\"GThread\"
DEPCFLAGS = $(PTHREAD_CFLAGS)

all : \
	gthread-$(GLIB_VER).dll

gthread_OBJECTS = \
	gthread-impl.obj

makefile.msc: makefile.msc.in
	$(SED) -e s,@GLIB[_]MAJOR_VERSION@,@GLIB_MAJOR_VERSION@, \
	       -e s,@GLIB[_]MINOR_VERSION@,@GLIB_MINOR_VERSION@, <makefile.msc.in >$@

gthread-$(GLIB_VER).dll : $(gthread_OBJECTS) gthread.def
	$(CC) $(CFLAGS) -LD -Fegthread-$(GLIB_VER).dll $(gthread_OBJECTS) ..\glib-$(GLIB_VER).lib $(PTHREAD_LIBS) $(LDFLAGS) /def:gthread.def
