## Makefile for building the GLib test programs with gcc for mingw.
## Use: make -f makefile.mingw check

TOP = ../..

include ../build/win32/make.mingw

# Possibly override GLib version in build\win32\module.defs
GLIB_VER = @GLIB_MAJOR_VERSION@.@GLIB_MINOR_VERSION@

################################################################

# Nothing much configurable below

INCLUDES = -I .. 
DEFINES = -DHAVE_CONFIG_H

TESTS = \
	array-test.exe	\
	date-test.exe	\
	dirname-test.exe\
	gio-test.exe	\
	hash-test.exe	\
	list-test.exe	\
	mainloop-test.exe\
	markup-test.exe	\
	node-test.exe	\
	queue-test.exe	\
	rand-test.exe	\
	relation-test.exe\
	shell-test.exe	\
	slist-test.exe	\
	spawn-test.exe	\
	strfunc-test.exe\
	string-test.exe	\
	thread-test.exe	\
	threadpool-test.exe\
	tree-test.exe	\
	type-test.exe	\
	unicode-encoding.exe

all:	$(TESTS)

ifeq ($(wildcard makefile.mingw.in),makefile.mingw.in)
makefile.mingw: makefile.mingw.in
	sed -e 's,@GLIB[_]MAJOR_VERSION@,@GLIB_MAJOR_VERSION@,' \
	    -e 's,@GLIB[_]MINOR_VERSION@,@GLIB_MINOR_VERSION@,' <$< >$@
endif

.SUFFIXES: .c .exe

.c.exe:
	$(CC) $(CFLAGS) -o $@ $< -L .. -lglib-$(GLIB_VER) -L ../gthread -lgthread-$(GLIB_VER)

check:	all
	@for P in $(TESTS) ; do echo $$P; ./$$P; done
	@echo All tests successful.
