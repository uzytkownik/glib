## Makefile for building the gobject DLL with gcc for mingw. The build
## uses tools running on cygwin, however.

## Use: make -f makefile.mingw


TOP = ../..

include ../build/win32/make.mingw

# Possibly override GLib version in build/win32/module.defs
GLIB_VER = @GLIB_MAJOR_VERSION@.@GLIB_MINOR_VERSION@

################################################################

# Nothing much configurable below

INCLUDES = -I .. -I .
DEFINES = -DHAVE_CONFIG_H -DGOBJECT_COMPILATION -DG_LOG_DOMAIN=g_log_domain_gobject

BUILD_DLL = ../build-dll

all :				\
	gobject-$(GLIB_VER).dll	\
	glib-genmarshal.exe

makefile.mingw: makefile.mingw.in
	sed -e 's,@GLIB[_]MAJOR_VERSION@,@GLIB_MAJOR_VERSION@,' \
	    -e 's,@GLIB[_]MINOR_VERSION@,@GLIB_MINOR_VERSION@,' <$< >$@

gobject_OBJECTS =		\
	gboxed.o		\
	gbsearcharray.o		\
	gclosure.o		\
	genums.o		\
	gobject.o		\
	gparam.o		\
	gparamspecs.o		\
	gsignal.o		\
	gtype.o			\
	gvalue.o		\
	gvaluetypes.o

gobject-$(GLIB_VER).dll : $(gobject_OBJECTS) gobject.def
	$(BUILD_DLL) gobject $(GLIB_VER) gobject.def $(gobject_OBJECTS) -L .. -lglib-$(GLIB_VER)

glib-genmarshal.exe : glib-genmarshal.c
	$(CC) -o $@ $(CFLAGS) -UGOBJECT_COMPILATION -DG_LOG_DOMAIN=\"glib-genmarshal\" $< -L .. -lglib-$(GLIB_VER) -L . -lgobject-$(GLIB_VER)
